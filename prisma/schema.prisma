// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String           @id @default(cuid())
  clerkId       String           @unique
  email         String           @unique
  firstName     String?
  lastName      String?
  imageUrl      String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  subscriptions Subscription[]
  billingHistory BillingHistory[]

  @@map("users")
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
  PAST_DUE
  TRIALING
}

model Subscription {
  id                 String            @id @default(cuid())
  userId             String
  clerkSubscriptionId String           @unique
  plan               String
  status             SubscriptionStatus
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  cancelAtPeriodEnd  Boolean           @default(false)
  canceledAt         DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  user               User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

enum BillingStatus {
  PAID
  PENDING
  FAILED
  REFUNDED
}

model BillingHistory {
  id            String         @id @default(cuid())
  userId        String
  clerkInvoiceId String?
  amount        Decimal        @db.Decimal(10, 2)
  currency      String         @default("USD")
  status        BillingStatus
  description   String?
  billingDate   DateTime
  createdAt     DateTime       @default(now())
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("billing_history")
}
